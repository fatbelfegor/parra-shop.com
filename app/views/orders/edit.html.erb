<link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
<script type="text/javascript" src="/js/jquery-ui.min.js"></script>
<%= form_for @order, html: {class: 'bootstrap-margin'} do |f| %>
	<br>
	<div class="row">
		<h2 class="col-md-4 col-md-offset-3 text-right"><%= f.label :number, "Спецификация к заказу №", {class: 'control-label wrath-content-box'} %></h2>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :number, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<br>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :created_at, "Дата заказа", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :created_at, class: 'datepicker form-control col-md-2', value: @order.created_at.strftime("%d %m %Y") %>
	      </div>
	    </div>
	</div>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :salon, "Салон", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :salon, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 col-md-offset-4 text-right"><%= f.label :salon_tel, "Телефон салона", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :salon_tel, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :manager, "Менеджер", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :manager, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 col-md-offset-4 text-right"><%= f.label :manager_tel, "Телефон менеджера", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :manager_tel, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<br>
	<br>
	<div class="row">
		<h3 class="col-md-2 text-right">Заказчик</h3>
	</div>
	<br>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :last_name, "Фамилия", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :last_name, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :first_name, "Имя", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :first_name, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :middle_name, "Отчество", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :middle_name, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :addr_street, "Улица", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_street, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :addr_home, "Дом", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_home, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :addr_block, "Корпус", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_block, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :phone, "Телефон", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :phone, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :addr_staircase, "Подъезд", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_staircase, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :addr_floor, "Этаж", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_floor, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :addr_metro, "Ст. метро", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_metro, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :addr_flat, "Квартира", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_flat, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :addr_code, "Код", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_code, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<div class="row">
		<h4 class="col-md-2 col-md-offset-4 text-right"><%= f.label :addr_elevator, "Лифт", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :addr_elevator, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<br>
	<br>
	<table class="table table-bordered table-striped text-center">
		<tr>
			<th>№ п/п</th>
			<th>Артикул</th>
			<th>Наименование изделия</th>
			<th>Цена за ед.</th>
			<th>Кол-во</th>
			<th>%</th>
			<th>Сумма</th>
		</tr>
		<% i = 0 %>
		<% q = p = 0 %>
		<% for item in @order.order_items %>
		<% q += item.quantity %>
		<% price = item.price*item.quantity*(1 - item.discount/100.0) %>
		<% p += price %>
		<tr>
			<td><%= i += 1 %></td>
			<td><%= item.product.scode %></td>
			<td><%= item.product.name %></td>
			<td><%= number_to_currency item.price %></td>
			<td><%= item.quantity %></td>
			<td><%= item.discount %></td>
			<td><%= number_to_currency price %></td>
		</tr>
		<% end %>
		<tr>
			<th></th>
			<th colspan="3">Описание дополнительного товара</th>
			<th colspan="3">Цена дополнительного товара</th>
		</tr>
		<% for virt in @order.virtproducts %>
		<% q += 1 %>
		<% p += virt.price %>
		<tr>
			<td><%= i += 1 %></td>
			<td colspan="3"><%= virt.text %></td>
			<td colspan="3"><%= number_to_currency virt.price %></td>
		</tr>
		<% end %>
		<tr>
			<th colspan="4" class="text-right">Стоимость товара</th>
			<th style="color: red"><%= q %></th>
			<td class="text-left">шт.</td>
			<th class="p" style="color: red"><%= number_to_currency p %></th>
		</tr>
		<tr>
			<th colspan="4" class="text-right">Стоимость доставки</th>
			<td colspan="2"><%= f.text_field :deliver_type, placeholder: 'Тип', class: 'form-control order-input' %></td>
			<td><%= f.text_field :deliver_cost, placeholder: 'Стоимость', class: 'form-control order-input', onkeyup: 'orderEditSum(this)' %></td>
		</tr>
		<tr>
			<th colspan="4" class="text-right">Итого</th>
			<td colspan="2"></td>
			<% if @order.deliver_cost then price = p + @order.deliver_cost else price = p end %>
			<th class="sum"><%= number_to_currency price %></th>
		</tr>
	</table>
	<br>
	<br>
	<div style="line-height: 36px">
		<div class="row">
			<b class="col-md-2 text-right">Предоплата</b>
			<div class="col-md-2 col-md-offset-2 text-center">дата оплаты</div>
			<%= f.text_field :prepayment_date, class: 'form-control order-input col-md-2' %>
			<div class="col-md-2 text-center">сумма</div>
			<%= f.text_field :prepayment_sum, class: 'form-control order-input col-md-2', onkeyup: 'orderEditSum(this)' %>
		</div>
		<div class="row">
			<b class="col-md-2 text-right">Доплата</b>
			<div class="col-md-2 col-md-offset-2 text-center">дата оплаты</div>
			<%= f.text_field :doppayment_date, class: 'form-control order-input col-md-2' %>
			<div class="col-md-2 text-center">сумма</div>
			<%= f.text_field :doppayment_sum, class: 'form-control order-input col-md-2', onkeyup: 'orderEditSum(this)' %>
		</div>
		<div class="row">
			<b class="col-md-2 text-right">Окончательный расчет</b>
			<div class="col-md-2 col-md-offset-2 text-center">дата оплаты</div>
			<%= f.text_field :finalpayment_date, class: 'form-control order-input col-md-2' %>
			<div class="col-md-2 text-center">сумма</div>
			<%= f.text_field :finalpayment_sum, class: 'form-control order-input col-md-2', onkeyup: 'orderEditSum(this)' %>
		</div>
		<div class="row">
			<b class="col-md-2 col-md-offset-8 text-center">Долг клиента</b>
			<% price -= @order.prepayment_sum unless @order.prepayment_sum.blank? %>
			<% price -= @order.doppayment_sum unless @order.doppayment_sum.blank? %>
			<% price -= @order.finalpayment_sum unless @order.finalpayment_sum.blank? %>
			<b class="col-md-2 text-center dolg" style="color: red"><%= number_to_currency price %></b>
		</div>
		<div class="row">
			<b class="col-md-2 col-md-offset-8 text-center">Способ оплаты заказа</b>
			<%= f.text_field :payment_type, class: 'form-control order-input col-md-2' %>
		</div>
	</div>
	<br>
	<br>
	<h3>Клиенту предоставлен кредит</h3>
	<br>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :credit_sum, "На сумму", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :credit_sum, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :credit_month, "Месяцев", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :credit_month, class: 'form-control col-md-2' %>
	      </div>
	    </div>
		<h4 class="col-md-2 text-right"><%= f.label :credit_procent, "%", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-2">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :credit_procent, class: 'form-control col-md-2' %>
	      </div>
	    </div>
	</div>
	<br>
	<br>
	<h3>ИНФОРМАЦИЯ О ДОСТАВКЕ</h3>
	<br>
	<div class="row">
		<h4 class="col-md-2 text-right"><%= f.label :deliver_date, "Доставка до", {class: 'control-label wrath-content-box'} %></h4>
		<div class="col-md-3">
	      <div class="wrath-content-box" style="padding:0 15px">
	        <%= f.text_field :deliver_date, class: 'form-control col-md-3' %>
	      </div>
	    </div>
	    <div class="col-md-3 text-center" style="line-height: 36px">
	    	<b>Сборка</b> - оплата по факту
	    </div>
	    <div class="col-md-4 text-center" style="line-height: 36px">
	    	<b>Подъем</b> - оплата см. Приложение №2
	    </div>
	</div>
	<br>
	<b>* при доставке за пределы МКАД,</b> в стоимость доставки включается фактический киллометраж (за 1 км. - 30р)
	<br>
	<br>
	<br>
	<br>
	<h3>Дополнительная информация</h3>
	<br>
	<br>
	<b>сборка 6%=2200, подъем 300 руб</b>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<table class="table table-striped fixed-buttons text-center">

	<tr><td>
	<div class="absolute">
	    <%= link_to 'Открыть', "/orders/#{@order.id}", class: 'btn btn-default' %>
	    <%= link_to 'Список Заказов', '/orders/', class: 'btn btn-default' %>
	</div>
	<%= f.submit 'Сохранить', class: "btn btn-success" %>
	</td></tr>

	</table>
<% end %>
<script>
    $( ".datepicker" ).datepicker({dateFormat: 'dd mm yy'});
</script>